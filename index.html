<!--
Para limpiar la PWA en Android:
1. Ajustes Android → Apps → Chrome → Storage → Site Storage → GastoGo → Borrar datos.
2. O en Chrome: chrome://settings/siteData, busca tu dominio, elimina datos.
-->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GastoGo...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: sans-serif; margin:0; padding:0; }
    header { background:#4CAF50; color:#fff; padding:1rem; text-align:center; }
    main { padding:1rem; }
    section { margin-top:1.5rem; border:1px solid #ddd; padding:1rem; border-radius:8px; }
    h2 { margin-top:0; }
    .flex { display:flex; align-items:center; }
    .flex > * { margin-right:8px; }
    .input-group { display:flex; align-items:center; }
    .input-group span { margin-right:8px; color:#666; pointer-events:none; }
    .error-msg { font-size:0.8rem; color:red; margin-top:-0.5rem; margin-bottom:0.5rem; }
    input.invalid { border-color:red; }
    input, select, textarea, button { display:block; width:100%; margin:0.5rem 0; padding:0.5rem; box-sizing:border-box; }
    .gasto-item, .hist-item { border-bottom:1px solid #ddd; padding:0.5rem 0; }
    .saldo { font-size:1.2rem; font-weight:bold; }
    /* Card general */
    .card { background: #fff; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); margin-bottom: 1.5rem; overflow: hidden; }
    .card header { display: flex; align-items: center; background: transparent; /*Transparente*/ color: #333; padding: 0.75rem 1rem; }
    .card header .icon { width: 64px; height: 50px; margin-right: 0.5rem; }
    .card header h2 { margin: 0; font-size: 1.25rem; }
    .card-body { padding: 1rem; }
    /* Grid de dos columnas dentro de la card */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; grid-gap: 1rem; align-items: end; }/* Cada control en su campo */
    .field { display: flex; flex-direction: column; }/* Para que este campo ocupe ancho completo */
    .field.full-width { grid-column: 1 / -1; display: flex; align-items: center; justify-content: space-between; }/* Estilos de label */
    .field label { font-size: 0.9rem; margin-bottom: 0.25rem; color: #333; }
     .btn-outline {
    background: transparent;
    border: 2px solid #007BFF;   /* azul Bootstrap */
    color: #007BFF;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.2s;
  }
  .btn-outline:hover {
    background: rgba(0, 123, 255, 0.1);  /* fondo azul muy suave */
  }

  /* (Opcional) Botones primarios en azul */
  .btn-primary {
    background: #007BFF;
    border: none;
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.2s;
  }
  .btn-primary:hover {
    background: #0069D9;
  }
    /* Cabecera principal */
body > header {
  background: #339BFF;    /* azul más claro */
  color: #fff;            /* texto blanco para contraste */
  padding: 1rem;
  text-align: center;
}
body > header h1 {
  margin: 0;
  font-size: 1.5rem;
  font-weight: normal;
}
    /* Distinción estado deshabilitado */
.btn-outline:disabled {
  border-color: #ccc;
  color: #ccc;
  background: transparent;
  opacity: 0.6;
  cursor: not-allowed;
}
.btn-primary:disabled {
  background: #ccc;
  color: #fff;
  opacity: 0.6;
  cursor: not-allowed;
}


  </style>
</head>
<body>
  <header><h1>GastoGo...</h1></header>
  <main>
    <!-- Ingresos -->
 <section id="secIngresos">
   <div class="card">
     <header>
       <!-- Aquí puedes cambiar la ruta o el nombre del icono -->
      <img src="assets/iconWall.png" alt="" class="icon">
       <h2>Definir Ingresos</h2>
     </header>

<div class="card-body">
  <div class="grid-2">
    <!-- Ingresos -->
    <div class="field">
      <label for="inputIngresos">Ingresos Mensuales</label>
      <div class="input-addon">
        <span class="addon">$</span>
        <input type="text" id="inputIngresos" placeholder="0,00">
      </div>
    </div>
    <div class="field">
      <button type="button" id="btnSetIngresos" class="btn-outline">Guardar</button>
    </div>

    <!-- Otros ingresos -->
    <div class="field">
      <label for="inputOtrosIngresos">Otros Ingresos</label>
      <div class="input-addon">
        <span class="addon">$</span>
        <input type="text" id="inputOtrosIngresos" placeholder="0,00">
      </div>
    </div>
    <div class="field">
      <button type="button" id="btnAddOtrosIngresos" class="btn-outline">Agregar Otros</button>
    </div>

    <!-- Finalizar mes + Saldo -->
    <div class="field full-width">
      <button type="button" id="btnFinalizarMes" class="btn-primary">Finalizar Mes</button>
      <span id="saldoRestante" class="saldo">$0,00</span>
    </div>
  </div>
</div>
 </section>
  
    <!-- Registrar Gasto -->
<section id="secGastos">
  <div class="card">
    <header>
    <img src="assets/iconCash.png" alt="" class="icon">
      <h2>Registrar Gasto</h2>
    </header>
    <div class="card-body">
      <div class="grid-2">
        <!-- Aquí irá el form que tenías -->
      <!-- Fecha -->
<div class="field">
  <label for="fecha">Fecha</label>
  <input type="date" id="fecha">
</div>
<!-- Categoría -->
<div class="field">
  <label for="categoria">Categoría</label>
  <select id="categoria">
    <option disabled selected value="">-- Seleccionar categoría --</option>
  </select>
</div>
<!-- Monto -->
<div class="field">
  <label for="monto">Monto</label>
  <div class="input-addon">
    <span class="addon">$</span>
    <input type="text" id="monto" placeholder="0,00">
  </div>
</div>
<!-- Botón Guardar -->
<div class="field">
  <button type="button" id="btnGuardar" class="btn-outline">Guardar Gasto</button>
</div>
<!-- Subcategoría -->
<div class="field">
  <label for="subcat">Subcategoría (opcional)</label>
  <select id="subcat">
    <option disabled selected value="">– Opcional –</option>
  </select>
  <div>
    <button type="button" id="btnAddSubcat">+</button>
    <button type="button" id="btnDelSubcat">–</button>
  </div>
</div>
<!-- Observaciones -->
<div class="field full-width">
  <label for="obs">Observaciones</label>
  <textarea id="obs" rows="2" placeholder="Anotaciones (opcional)"></textarea>
</div>

      </div>
      <div class="flex">
        <select id="categoria">
          <option disabled selected value="">-- Seleccionar categoría --</option>
        </select>
        <button type="button" id="btnAddCat">+</button>
        <button type="button" id="btnDelCat">–</button>
      </div>
      <div class="flex" style="align-items:center">
  <select id="subcat">
    <option disabled selected value="">– Opcional: Subcategoría –</option>
  </select>
  <button type="button" id="btnAddSubcat" title="Agregar subcategoría" style="margin-left:8px">+</button>
  <button type="button" id="btnDelSubcat" title="Eliminar subcategoría" style="margin-left:4px">–</button>
</div>

      <textarea id="obs" placeholder="Observaciones"></textarea>
      <button type="button" id="btnGuardar">Guardar Gasto</button>
    </section>

    <!-- Historial de Gastos -->
    <section id="secHistorial">
  <div class="card">
    <header>
     <img src="assets/iconTime.png" alt="" class="icon">
      <h2>Historial de Gastos</h2>
    </header>
      <div id="listaGastos"></div>
    </section>

    <!-- Historial de Meses -->
    <section id="secHistorialMeses">
  <div class="card">
    <header>
        <img src="assets/iconCalend.png" alt="" class="icon">
      <h2>Historial de Meses Finalizados</h2>
    </header>
      <div id="listaMeses"></div>
    </section>
  </main>

 <script>
  // Helper: formatea centavos derecha→izquierda con . de miles y , decimal
  function formatRL(str) {
    let digits = ('' + str).replace(/\D/g, '');
    digits = digits.slice(-10);
    while (digits.length < 3) digits = '0' + digits;
    let intPart = digits.slice(0, -2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    let decPart = digits.slice(-2);
    return intPart + ',' + decPart;
  }

  document.addEventListener('DOMContentLoaded', init);

  function init() {
    // Referencias DOM
    const inpI     = document.getElementById('inputIngresos'),
          btnI     = document.getElementById('btnSetIngresos'),
          inpO     = document.getElementById('inputOtrosIngresos'),
          btnO     = document.getElementById('btnAddOtrosIngresos'),
          fechaInput = document.getElementById('fecha'),
          montoInput = document.getElementById('monto'),
          selCat     = document.getElementById('categoria'),
          btnGuardar = document.getElementById('btnGuardar'),
          btnFin     = document.getElementById('btnFinalizarMes'),
          subcat     = document.getElementById('subcat'),
          btnAddSubcat = document.getElementById('btnAddSubcat'),
          btnDelSubcat = document.getElementById('btnDelSubcat'),
          saldoEl     = document.getElementById('saldoRestante');

    // Claves de storage
    const keyI = 'ingresos',
          keyO = 'otrosIngresos',
          keyG = 'gastos',
          keyH = 'historial',
          keyC = 'categorias',
          keyS = 'subcategorias';

    // Datos iniciales
    let ingresos       = parseFloat(localStorage.getItem(keyI)) || 0,
        otrosIngresos = JSON.parse(localStorage.getItem(keyO) || '[]'),
        gastos         = JSON.parse(localStorage.getItem(keyG) || '[]'),
        categorias     = JSON.parse(localStorage.getItem(keyC) || '[]'),
        subcategorias  = JSON.parse(localStorage.getItem(keyS) || '[]'),
        historial       = JSON.parse(localStorage.getItem(keyH) || '[]');

    // Carga inicial de UI
    fechaInput.value = new Date().toISOString().slice(0,10);
    inpI.value   = formatRL( ingresos ? (ingresos*100).toString() : '' );
    inpO.value   = formatRL('');
    montoInput.value = formatRL('');
    if (ingresos > 0) {
      inpI.disabled = true;
      btnI.disabled = true;
    }

// Formateo dinámico con tope 8 enteros + 2 decimales
[inpI, inpO, montoInput].forEach(el => {
  el.addEventListener('input', function(e) {
    // 1) Extraer solo dígitos
    let digits = e.target.value.replace(/\D/g, '');
    // 2) Limitar a 10 dígitos (8 enteros + 2 decimales)
    if (digits.length > 10) {
      digits = digits.slice(0, 10);
    }
    // 3) Formatear y asignar
    e.target.value = formatRL(digits);
  });
});


// --- Finalizar Mes con bloqueo/restauración de ingresos ---
btnFin.onclick = function(){
  if (!confirm('¿Estás seguro que deseas finalizar el mes?')) return;
  historial.unshift({ ingresos, otrosIngresos, gastos, fecha: new Date().toISOString() });
  localStorage.setItem(keyH, JSON.stringify(historial));
  // Reset de datos
  ingresos = 0; otrosIngresos = []; gastos = [];
  localStorage.removeItem(keyI);
  localStorage.setItem(keyO, JSON.stringify(otrosIngresos));
  localStorage.setItem(keyG, JSON.stringify(gastos));
  // Reset UI
  inpI.value = formatRL(''); inpO.value = formatRL(''); montoInput.value = formatRL('');
  // Restablecer toggles
  inpI.disabled = false; btnI.disabled = false; toggleSetIngresos();
  toggleFinalizarMes();
  refreshGastos(); refreshMeses(); refreshSaldo();
};


    // Handlers de botones
    btnI.onclick = function(){
      if (!confirm('¿Desea guardar el monto ingresado?')) return;
      ingresos = parseFloat(inpI.value.replace(/\./g,'').replace(',','.')) || 0;
      localStorage.setItem(keyI, ingresos);
      refreshSaldo();
      gastos = []; otrosIngresos = [];
      localStorage.setItem(keyG, JSON.stringify(gastos));
      localStorage.setItem(keyO, JSON.stringify(otrosIngresos));
      inpI.disabled = true; btnI.disabled = true;
      refreshGastos(); refreshMeses(); refreshSaldo();
      toggleFinalizarMes();
    };
    btnO.onclick = function(){
      if (!confirm('¿Desea agregar este monto a Otros Ingresos?')) return;
      const o = parseFloat(inpO.value.replace(/\./g,'').replace(',','.'))||0;
      otrosIngresos.push(o);
      localStorage.setItem(keyO, JSON.stringify(otrosIngresos));
      inpO.value = formatRL('');
      refreshSaldo();
    };
    btnGuardar.onclick = function(){
      const raw = montoInput.value.replace(/\./g,'').replace(',','.');
      const num = parseFloat(raw) || 0;
      gastos.unshift({
        fecha: fechaInput.value,
        monto: num,
        categoria: selCat.value,
        subcat: subcat.value,
        obs: obs.value
      });
      localStorage.setItem(keyG, JSON.stringify(gastos));
      montoInput.value = formatRL('');
      toggleGuardarGasto();
      refreshGastos(); refreshSaldo();
    };
    btnFin.onclick = function(){
      if (!confirm('¿Estás seguro que deseas finalizar el mes?')) return;
      historial.unshift({ ingresos, otrosIngresos, gastos, fecha: new Date().toISOString() });
      localStorage.setItem(keyH, JSON.stringify(historial));
      ingresos = 0; otrosIngresos = []; gastos = [];
      localStorage.removeItem(keyI);
      localStorage.setItem(keyO, JSON.stringify(otrosIngresos));
      localStorage.setItem(keyG, JSON.stringify(gastos));
      inpI.disabled = false; btnI.disabled = false;
      inpI.value = formatRL('');
      refreshGastos(); refreshMeses(); refreshSaldo();
      toggleFinalizarMes();
    };
  }
</script>

</body>
</html>
