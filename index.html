<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GastoGo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: sans-serif; margin:0; padding:0 }
    header { background:#4CAF50; color:#fff; padding:1rem; text-align:center }
    main { padding:1rem }
    input, select, textarea, button { display:block; width:100%; margin:0.5rem 0; padding:0.5rem; }
    .gasto-item { border-bottom:1px solid #ddd; padding:0.5rem 0; }
  </style>
</head>
<body>
  <header><h1>GastoGo</h1></header>
  <main> 

        <!-- Ingresos -->
    <section id="secIngresos">
      <h2>Definir Ingresos</h2>
      <div class="flex" style="align-items:center">
        <input type="number" id="inputIngresos" placeholder="Monto de ingresos" />
        <button id="btnSetIngresos" style="margin-left:8px">Guardar</button>
      </div>
      <div class="flex" style="align-items:center">
        <input type="number" id="inputOtrosIngresos" placeholder="Otros ingresos" />
        <button id="btnAddOtrosIngresos" style="margin-left:8px">Agregar Otros</button>
      </div>
      <div class="saldo">
        Saldo restante: <span id="saldoRestante">$0.00</span>
      </div>
    </section>

    
    <h2>Registrar gasto</h2>
    <input type="date" id="fecha" />
    <input type="number" id="monto" placeholder="Monto" />
    
  <div class="flex" style="align-items:center">
    <select id="categoria">
      <option disabled selected value="">-- Seleccionar categor√≠a --</option>
    </select>
    <button id="btnAddCat" title="Agregar categor√≠a" style="margin-left:8px">+</button>
    <button id="btnDelCat" title="Eliminar categor√≠a" style="margin-left:4px">‚Äì</button>
  </div>

    <input type="text" id="subcat" placeholder="Subcategor√≠a" />
    <textarea id="obs" placeholder="Observaciones"></textarea>
    <button id="btnGuardar">Guardar Gasto</button>

    <h2 class="gastos">Historial</h2>
    <div id="listaGastos"></div>
  </main>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
      console.log('‚úÖ GastoGo script arranc√≥');
// --- Claves y carga inicial ---
const keyG = 'gastos',
      keyC = 'categorias',
      keyI = 'ingresos',
      keyO = 'otrosIngresos',
      keyM = 'moneda';
let gastos         = JSON.parse(localStorage.getItem(keyG) || '[]');
let ingresos       = parseFloat(localStorage.getItem(keyI)) || 0;
let otrosIngresos  = JSON.parse(localStorage.getItem(keyO)) || [];
let moneda         = localStorage.getItem(keyM) || '$';

   

   // Carga categor√≠as por defecto si no existen
    if (!localStorage.getItem(keyC)) {
      localStorage.setItem(keyC, JSON.stringify([
        "Vivienda",
        "Impuestos y servicios",
        "Veh√≠culo",
        "Otros gastos"
      ]));
    }
     // --- FORZAR CATEGOR√çAS POR DEFECTO ---
    const defaultCats = [
      "Vivienda",
      "Impuestos y servicios",
      "Veh√≠culo",
      "Otros gastos"
    ];
    // Siempre reiniciamos a esos valores
    localStorage.setItem(keyC, JSON.stringify(defaultCats));
    let categorias = [...defaultCats];

    // Referencia al combo
    const selCat = document.getElementById('categoria');

    // Funci√≥n para poblar el combo
    function refreshCategories() {
      selCat.innerHTML = `
        <option disabled selected value="">-- Seleccionar categor√≠a --</option>
        ${categorias.map(c => `<option value="${c}">${c}</option>`).join('')}
      `;
    }

    // Referencias a los botones
const btnAddCat = document.getElementById('btnAddCat');
const btnDelCat = document.getElementById('btnDelCat');

// Agregar nueva categor√≠a con prompt
btnAddCat.addEventListener('click', () => {
  const nueva = prompt('Nombre de la nueva categor√≠a:');
  if (!nueva) return;
  const trimCat = nueva.trim();
  if (categorias.includes(trimCat)) {
    alert('La categor√≠a ya existe.');
  } else {
    categorias.push(trimCat);
    localStorage.setItem(keyC, JSON.stringify(categorias));
    refreshCategories();
    // Seleccionamos la nueva categor√≠a
    document.getElementById('categoria').value = trimCat;
  }
});

// Eliminar categor√≠a seleccionada
btnDelCat.addEventListener('click', () => {
  const actual = document.getElementById('categoria').value;
  if (!actual) return alert('Selecciona primero una categor√≠a.');
  if (confirm(`¬øEliminar la categor√≠a "${actual}"?`)) {
    categorias = categorias.filter(c => c !== actual);
    localStorage.setItem(keyC, JSON.stringify(categorias));
    refreshCategories();
  }
});

        // --- Secci√≥n Ingresos y Saldo ---
    const inpIngresos    = document.getElementById('inputIngresos');
    const btnSetIngresos = document.getElementById('btnSetIngresos');
    const inpOtros      = document.getElementById('inputOtrosIngresos');
    const btnAddOtros   = document.getElementById('btnAddOtrosIngresos');
    const saldoEl       = document.getElementById('saldoRestante');

  

    // Carga inicial de ingresos


    // Funci√≥n para recalcular y mostrar el saldo
    function refreshSaldo() {
    // Suma todos los montos de gastos, ignorando NaN
    const totalG = gastos.reduce((sum, g) => {
      const val = parseFloat(g.monto);
      return sum + (isNaN(val) ? 0 : val);
    }, 0);

    // Suma todos los ‚Äúotros ingresos‚Äù, ignorando NaN
    const totalO = otrosIngresos.reduce((sum, o) => {
      const val = parseFloat(o);
      return sum + (isNaN(val) ? 0 : val);
    }, 0);

    // C√°lculo final: ingresos base + otros - gastos
    const restante = ((parseFloat(ingresos) || 0) + totalO - totalG).toFixed(2);

    // Actualiza en pantalla
    document.getElementById('saldoRestante').textContent = `${moneda}${restante}`;
  }


    // Inicializaci√≥n de inputs y saldo
    inpIngresos.value = ingresos || '';
    refreshSaldo();

    //  Guardar ingreso base y bloquear edici√≥n
    btnSetIngresos.addEventListener('click', () => {
      console.log('üîî btnSetIngresos clicked:', inpIngresos.value);
      ingresos = parseFloat(inpIngresos.value) || 0;
      localStorage.setItem(keyI, ingresos);
      inpIngresos.disabled = true;
      btnSetIngresos.disabled = true;
      refreshSaldo();
    });

    // Agregar ‚ÄúOtros Ingresos‚Äù
    btnAddOtros.addEventListener('click', () => {
      console.log('üîî btnAddOtrosIngresos clicked:', inpOtros.value);
      const o = parseFloat(inpOtros.value) || 0;
      otrosIngresos.push(o);
      localStorage.setItem(keyO, JSON.stringify(otrosIngresos));
      inpOtros.value = '';
      refreshSaldo();
    });

    
    // Llamamos al refresco inicial
    refreshCategories();


    function refreshList() {
      const html = gastos.map(g =>
        `<div class="gasto-item">
          ${g.fecha} ‚Äì ${g.categoria}/${g.subcat}: $${g.monto}
        </div>`
      ).join('');
      document.getElementById('listaGastos').innerHTML = html || '<em>No hay gastos</em>';
    }

    // --- 3. Eventos ---
    btnGuardar.addEventListener('click', () => {
      console.log('üîî btnGuardar clicked:',
      const g = {
        fecha:     document.getElementById('fecha').value,
        monto:     document.getElementById('monto').value,
        categoria: selCat.value,
        subcat:    document.getElementById('subcat').value
      };
      gastos.unshift(g);
      localStorage.setItem(keyG, JSON.stringify(gastos));
      refreshList();
      refreshSaldo();
    });

    // --- 4. Inicializaci√≥n ---
    refreshCategories();
    refreshList();
  });
</script>

</body>
</html>
