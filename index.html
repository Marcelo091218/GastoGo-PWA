<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GastoGo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: sans-serif; margin:0; padding:0; }
    header { background:#4CAF50; color:#fff; padding:1rem; text-align:center; }
    main { padding:1rem; }
    section { margin-top:1.5rem; border:1px solid #ddd; padding:1rem; border-radius:8px; }
    h2 { margin-top:0; }
    input, select, textarea, button { display:block; width:100%; margin:0.5rem 0; padding:0.5rem; box-sizing:border-box; }
    .gasto-item { border-bottom:1px solid #ddd; padding:0.5rem 0; }
    .flex { display:flex; justify-content: space-between; align-items: center; }
    .saldo { font-size:1.2rem; font-weight:bold; }
    .hist-item { border-bottom:1px solid #ccc; padding:0.5rem 0; }
  </style>
</head>
<body>
  <header><h1>GastoGo</h1></header>
  <main>
    <!-- Selección de moneda -->
    <section id="secMoneda">
      <h2>Elige tu moneda</h2>
      <select id="selMoneda">
        <option value="$">$ Pesos</option>
        <option value="USD">USD</option>
      </select>
    </section>

    <!-- Administrar Categorías -->
<section id="secCategorias">
  <h2>Administrar Categorías</h2>
  <div class="flex">
    <input type="text" id="inputNuevaCategoria" placeholder="Nueva categoría" />
    <button id="btnAddCategoria">Agregar Categoría</button>
  </div>
  <div id="listaCategorias"></div>
</section>

    
<!-- Ingresos -->
<section id="secIngresos">
  <h2>Definir Ingresos Mensuales</h2>
  <div class="flex">
    <input type="number" id="inputIngresos" placeholder="Monto de ingresos" />
    <button id="btnSetIngresos">Guardar</button>
  </div>
  <div class="flex">
    <input type="number" id="inputOtrosIngresos" placeholder="Otros ingresos" />
    <button id="btnAddOtrosIngresos">Agregar Otros Ingresos</button>
  </div>
  <div class="saldo">Saldo restante: <span id="saldoRestante"></span></div>
  <button id="btnFinalizarMes">Finalizar Mes</button>
</section>


    <!-- Registrar Gasto -->
    <section id="secGastos">
      <h2>Registrar Gasto</h2>
      <input type="date" id="fecha" />
      <input type="number" id="monto" placeholder="Monto" />
      <select id="categoria"></select>
      <input type="text" id="subcat" placeholder="Subcategoría" />
      <textarea id="obs" placeholder="Observaciones"></textarea>
      <button id="btnGuardar">Guardar Gasto</button>
    </section>

    <!-- Historial de Gastos -->
    <section id="secHistorial">
      <h2>Historial de Gastos</h2>
      <div id="listaGastos"></div>
    </section>

    <!-- Historial de Meses -->
    <section id="secHistorialMeses">
      <h2>Historial de Meses Finalizados</h2>
      <div id="listaMeses"></div>
    </section>
  </main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- Claves y carga inicial ---
  const keyG = 'gastos',
        keyC = 'categorias',
        keyI = 'ingresos',
        keyO = 'otrosIngresos',
        keyH = 'historialMeses',
        keyM = 'moneda';
  let gastos = JSON.parse(localStorage.getItem(keyG) || '[]');
  // Cargar categorías default si no existen
  if (!localStorage.getItem(keyC)) {
    localStorage.setItem(keyC, JSON.stringify(
      ["Vivienda","Impuestos y servicios","Vehículo","Otros gastos"]
    ));
  }
  let categorias = JSON.parse(localStorage.getItem(keyC));
  let ingresos = parseFloat(localStorage.getItem(keyI) || '0');
  let otrosIngresos = JSON.parse(localStorage.getItem(keyO) || '[]');
  let historial = JSON.parse(localStorage.getItem(keyH) || '[]');
  let moneda = localStorage.getItem(keyM) || '$';

  // --- Elementos del DOM ---
  const selMon        = document.getElementById('selMoneda');
  const frameCats     = document.getElementById('listaCategorias');
  const inputNewCat   = document.getElementById('inputNuevaCategoria');
  const btnAddCat     = document.getElementById('btnAddCategoria');
  const selCat        = document.getElementById('categoria');
  const inpIng        = document.getElementById('inputIngresos');
  const btnSetIng     = document.getElementById('btnSetIngresos');
  const inpOtros      = document.getElementById('inputOtrosIngresos');
  const btnAddOtros   = document.getElementById('btnAddOtrosIngresos');
  const saldoEl       = document.getElementById('saldoRestante');
  const btnGuardar    = document.getElementById('btnGuardar');
  const montoInput    = document.getElementById('monto');
  const subcatInput   = document.getElementById('subcat');
  const obsInput      = document.getElementById('obs');

  // --- Funciones de refresco ---
  function refreshMoneda() {
    selMon.value = moneda;
  }
  function refreshCats() {
    // Combo de registro de gasto
    selCat.innerHTML = categorias.map(c => `<option>${c}</option>`).join('');
  }
  function refreshCatList() {
    frameCats.innerHTML = categorias.map((c,i) =>
      `<div class="gasto-item">
         ${c} <button onclick="deleteCategoria(${i})">❌</button>
       </div>`
    ).join('') || '<em>No hay categorías</em>';
  }
  function refreshGastos() {
    document.getElementById('listaGastos').innerHTML =
      gastos.map(g=>`
        <div class="gasto-item">
          ${g.fecha} – ${g.categoria}/${g.subcat}: ${moneda}${parseFloat(g.monto).toFixed(2)}
        </div>
      `).join('') || '<em>No hay gastos</em>';
  }
  function refreshMeses() {
    // ...
  }
  function refreshSaldo() {
    const totalG = gastos.reduce((s,g)=>s + parseFloat(g.monto),0);
    const totalO = otrosIngresos.reduce((s,o)=>s + parseFloat(o),0);
    const restante = (ingresos + totalO - totalG).toFixed(2);
    saldoEl.textContent = `${moneda}${restante}`;
  }

  // --- Eventos ABM Categorías ---
  window.deleteCategoria = idx => {
    categorias.splice(idx,1);
    localStorage.setItem(keyC, JSON.stringify(categorias));
    refreshCats(); refreshCatList();
  };
  btnAddCat.addEventListener('click', () => {
    const n = inputNewCat.value.trim();
    if (!n) return alert('Ingresa un nombre de categoría');
    categorias.push(n);
    localStorage.setItem(keyC, JSON.stringify(categorias));
    inputNewCat.value = '';
    refreshCats(); refreshCatList();
  });

  // --- Eventos Moneda ---
  selMon.addEventListener('change', () => {
    moneda = selMon.value;
    localStorage.setItem(keyM, moneda);
    refreshGastos(); refreshSaldo(); refreshMeses();
  });

  // --- Eventos Ingresos y Otros ---
  btnSetIng.addEventListener('click', () => {
    ingresos = parseFloat(inpIng.value) || 0;
    localStorage.setItem(keyI, ingresos);
    inpIng.disabled = true; btnSetIng.disabled = true;
    refreshSaldo();
  });
  btnAddOtros.addEventListener('click', () => {
    const o = parseFloat(inpOtros.value) || 0;
    otrosIngresos.push(o);
    localStorage.setItem(keyO, JSON.stringify(otrosIngresos));
    inpOtros.value = '';
    refreshSaldo();
  });

  // --- Eventos Guardar Gasto con limpieza e inhabilitación ---
  btnGuardar.disabled = true;
  [montoInput, subcatInput].forEach(el => {
    el.addEventListener('input', () => {
      btnGuardar.disabled = !(montoInput.value && subcatInput.value);
    });
  });
  btnGuardar.addEventListener('click', () => {
    const g = {
      fecha:    document.getElementById('fecha').value,
      monto:    montoInput.value,
      categoria: selCat.value,
      subcat:   subcatInput.value,
      obs:      obsInput.value
    };
    gastos.unshift(g);
    localStorage.setItem(keyG, JSON.stringify(gastos));
    refreshGastos(); refreshSaldo();
    // limpieza de campos
    montoInput.value = '';
    subcatInput.value = '';
    obsInput.value = '';
    btnGuardar.disabled = true;
  });

  // --- Inicialización UI ---
  refreshMoneda();
  if (!ingresos) inpIng.value = '';
  refreshCats(); refreshCatList();
  refreshGastos(); refreshSaldo(); // y refreshMeses si la usas
});
</script>


</body>
</html>
