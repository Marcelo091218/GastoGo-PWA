<!DOCTYPE html><html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GastoGo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: sans-serif; margin:0; padding:0 }
    header { background:#4CAF50; color:#fff; padding:1rem; text-align:center }
    main { padding:1rem }
    section { margin-top:1.5rem; border:1px solid #ddd; padding:1rem; border-radius:8px }
    h2 { margin-top:0 }
    input, select, textarea, button { display:block; width:100%; margin:0.5rem 0; padding:0.5rem; box-sizing:border-box }
    .flex { display:flex; align-items:center }
    .flex > * { margin-right:8px }
    .gasto-item, .hist-item { border-bottom:1px solid #ddd; padding:0.5rem 0 }
    .saldo { font-size:1.2rem; font-weight:bold }
  </style>
</head>
<body>
  <header><h1>GastoGo</h1></header>
  <main>
    <!-- Ingresos -->
    <section id="secIngresos">
      <h2>Definir Ingresos</h2>
      <div class="flex">
        <input type="number" id="inputIngresos" placeholder="Monto de ingresos" />
        <button id="btnSetIngresos">Guardar</button>
      </div>
      <div class="flex">
        <input type="number" id="inputOtrosIngresos" placeholder="Otros ingresos" />
        <button id="btnAddOtrosIngresos">Agregar Otros</button>
      </div>
      <div class="saldo">Saldo restante: <span id="saldoRestante">$0.00</span></div>
    </section><!-- Registrar Gasto -->
<section id="secGastos">
  <h2>Registrar gasto</h2>
  <input type="date" id="fecha" />
  <input type="number" id="monto" placeholder="Monto" />
  <div class="flex">
    <select id="categoria">
      <option disabled selected value="">-- Seleccionar categoría --</option>
    </select>
    <button id="btnAddCat">+</button>
    <button id="btnDelCat">–</button>
  </div>
  <input type="text" id="subcat" placeholder="Subcategoría" />
  <textarea id="obs" placeholder="Observaciones"></textarea>
  <button id="btnGuardar">Guardar Gasto</button>
</section>

<!-- Historial de Gastos -->
<section id="secHistorial">
  <h2>Historial de Gastos</h2>
  <div id="listaGastos"></div>
</section>

<!-- Historial de Meses -->
<section id="secHistorialMeses">
  <h2>Historial de Meses Finalizados</h2>
  <div id="listaMeses"></div>
</section>

  </main>  <script>
  document.addEventListener('DOMContentLoaded', () => {
    console.log('✅ GastoGo script arrancó');
    const keyG = 'gastos', keyC = 'categorias', keyI = 'ingresos', keyO = 'otrosIngresos', keyM = 'moneda';
    let gastos = JSON.parse(localStorage.getItem(keyG) || '[]');
    let ingresos = parseFloat(localStorage.getItem(keyI)) || 0;
    let otrosIngresos = JSON.parse(localStorage.getItem(keyO) || '[]');
    let moneda = localStorage.getItem(keyM) || '$';

    const defaultCats = ["Vivienda","Impuestos y servicios","Vehículo","Otros gastos"];
    if (!localStorage.getItem(keyC)) {
      localStorage.setItem(keyC, JSON.stringify(defaultCats));
    }
    let categorias = JSON.parse(localStorage.getItem(keyC));

    const inpIngresos = document.getElementById('inputIngresos');
    const btnSetIngresos = document.getElementById('btnSetIngresos');
    const inpOtros = document.getElementById('inputOtrosIngresos');
    const btnAddOtros = document.getElementById('btnAddOtrosIngresos');
    const saldoEl = document.getElementById('saldoRestante');
    const selCat = document.getElementById('categoria');
    const btnAddCat = document.getElementById('btnAddCat');
    const btnDelCat = document.getElementById('btnDelCat');
    const montoInput = document.getElementById('monto');
    const subcatInput = document.getElementById('subcat');
    const obsInput = document.getElementById('obs');
    const btnGuardar = document.getElementById('btnGuardar');

    function refreshCategories() {
      selCat.innerHTML = `<option disabled selected value="">-- Seleccionar categoría --</option>` + categorias.map(c => `<option value="${c}">${c}</option>`).join('');
    }
    function refreshGastos() {
      document.getElementById('listaGastos').innerHTML =
        gastos.map(g => `<div class="gasto-item">${g.fecha} – ${g.categoria}/${g.subcat}: ${moneda}${parseFloat(g.monto).toFixed(2)}</div>`).join('') || '<em>No hay gastos</em>';
    }
    function refreshMeses() {
      document.getElementById('listaMeses').innerHTML = '<em>No hay meses finalizados</em>';
    }
    function refreshSaldo() {
      const totalG = gastos.reduce((s, g) => s + (parseFloat(g.monto) || 0), 0);
      const totalO = otrosIngresos.reduce((s, o) => s + (parseFloat(o) || 0), 0);
      const restante = ((ingresos + totalO - totalG) || 0).toFixed(2);
      saldoEl.textContent = `${moneda}${restante}`;
    }

    inpIngresos.value = ingresos;
    refreshCategories(); refreshGastos(); refreshMeses(); refreshSaldo();

    // Formateo en blur/focus para campos numéricos
function formatNumber(val) {
  // Convertir coma a punto y remover puntos
  var num = parseFloat(val.replace(/\./g, '').replace(',', '.'));
  if (isNaN(num)) num = 0;
  // Limitar enteros a 8 dígitos
  var parts = num.toFixed(2).split('.');
  var intPart = parts[0];
  var decPart = parts[1];
  if (intPart.length > 8) intPart = intPart.slice(-8);
  // Separador miles
  intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
  return intPart + ',' + decPart;
}
[inpI, inpO, montoInput].forEach(function(el) {
  el.addEventListener('focus', function() {
    // Mostrar número sin formato
    this.value = this.value.replace(/\./g, '').replace(',', '.');
  });
  el.addEventListener('blur', function() {
    this.value = formatNumber(this.value);
  });
});
    
    btnSetIngresos.addEventListener('click', () => {
      ingresos = parseFloat(inpIngresos.value) || 0;
      localStorage.setItem(keyI, ingresos);
      inpIngresos.disabled = true;
      btnSetIngresos.disabled = true;
      refreshSaldo();
    });
    btnAddOtros.addEventListener('click', () => {
      const o = parseFloat(inpOtros.value) || 0;
      otrosIngresos.push(o);
      localStorage.setItem(keyO, JSON.stringify(otrosIngresos));
      inpOtros.value = '';
      refreshSaldo();
    });
    btnAddCat.addEventListener('click', () => {
      const nueva = prompt('Nueva categoría:');
      if (nueva && !categorias.includes(nueva.trim())) {
        categorias.push(nueva.trim());
        localStorage.setItem(keyC, JSON.stringify(categorias));
        refreshCategories();
      }
    });
    btnDelCat.addEventListener('click', () => {
      const actual = selCat.value;
      if (!actual) return alert('Selecciona categoría');
      categorias = categorias.filter(c => c !== actual);
      localStorage.setItem(keyC, JSON.stringify(categorias));
      refreshCategories();
    });
    [montoInput, subcatInput].forEach(el => el.addEventListener('input', () => {
      btnGuardar.disabled = !(montoInput.value && subcatInput.value);
    }));
    btnGuardar.addEventListener('click', () => {
      const g = {
        fecha: document.getElementById('fecha').value,
        monto: montoInput.value,
        categoria: selCat.value,
        subcat: subcatInput.value,
        obs: obsInput.value
      };
      gastos.unshift(g);
      localStorage.setItem(keyG, JSON.stringify(gastos));
      refreshGastos();
      refreshSaldo();
      montoInput.value = '';
      subcatInput.value = '';
      obsInput.value = '';
      btnGuardar.disabled = true;
    });
  });
  </script></body>
</html
